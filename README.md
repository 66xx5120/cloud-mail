<p align="center">
  <img src="doc/demo/logo.png" width="80px" />
</p>

<div align="center">
<h1>Cloud Mail</h1>
</div>
<div align="center">
    <h4>Serverless å“åº”å¼é‚®ç®±æœåŠ¡ï¼Œæ”¯æŒé‚®ä»¶å‘é€ï¼Œå¯éƒ¨ç½²åˆ°Cloudflareå¹³å° ğŸ‰</h4> 
</div>
<div align="center">
    <span>ç®€ä½“ä¸­æ–‡ | <a href="/README-en.md" style="margin-left: 5px">English </a></span>
</div>

## é¡¹ç›®ç®€ä»‹

åªéœ€è¦ä¸€ä¸ªåŸŸåï¼Œå°±å¯ä»¥åˆ›å»ºå¤šä¸ªä¸åŒçš„é‚®ç®±ï¼Œç±»ä¼¼å„å¤§é‚®ç®±å¹³å°ï¼Œæœ¬é¡¹ç›®å¯éƒ¨ç½²åˆ° Cloudflare Workers ï¼Œé™ä½æœåŠ¡å™¨æˆæœ¬ï¼Œæ­å»ºè‡ªå·±çš„é‚®ç®±æœåŠ¡

## é¡¹ç›®å±•ç¤º

- [åœ¨çº¿æ¼”ç¤º](https://skymail.ink)<br>
- [éƒ¨ç½²æ–‡æ¡£](https://doc.skymail.ink)<br>
- [ç•Œé¢éƒ¨ç½²](https://doc.skymail.ink/guide/via-ui.html)

| ![](/doc/demo/demo1.png) | ![](/doc/demo/demo2.png) |
|-----------------------|-----------------------|
| ![](/doc/demo/demo3.png) | ![](/doc/demo/demo4.png) |




## åŠŸèƒ½ä»‹ç»

- **ğŸ’° ä½æˆæœ¬ä½¿ç”¨**ï¼š éƒ¨ç½²åˆ° Cloudflare Workers é™ä½æœåŠ¡å™¨æˆæœ¬

- **ğŸ’» å“åº”å¼è®¾è®¡**ï¼šå“åº”å¼å¸ƒå±€è‡ªåŠ¨é€‚é…PCå’Œå¤§éƒ¨åˆ†æ‰‹æœºç«¯æµè§ˆå™¨

- **ğŸ“§ é‚®ä»¶å‘é€**ï¼šé›†æˆResendå‘é€é‚®ä»¶ï¼Œæ”¯æŒç¾¤å‘ï¼Œå†…åµŒå›¾ç‰‡å’Œé™„ä»¶å‘é€ï¼Œå‘é€çŠ¶æ€æŸ¥çœ‹

- **ğŸ›¡ï¸ ç®¡ç†å‘˜åŠŸèƒ½**ï¼šå¯ä»¥å¯¹ç”¨æˆ·ï¼Œé‚®ä»¶è¿›è¡Œç®¡ç†ï¼ŒRABCæƒé™æ§åˆ¶å¯¹åŠŸèƒ½åŠä½¿ç”¨èµ„æºé™åˆ¶

- **ğŸ“¦ é™„ä»¶æ”¶å‘**ï¼šæ”¯æŒæ”¶å‘é™„ä»¶ï¼Œä½¿ç”¨R2å¯¹è±¡å­˜å‚¨ä¿å­˜å’Œä¸‹è½½æ–‡ä»¶

- **ğŸ”” é‚®ä»¶æ¨é€**ï¼šæ¥æ”¶é‚®ä»¶åå¯ä»¥è½¬å‘åˆ°TGæœºå™¨äººæˆ–å…¶ä»–æœåŠ¡å•†é‚®ç®±

- **ğŸ“¡ å¼€æ”¾API**ï¼šæ”¯æŒä½¿ç”¨APIæ‰¹é‡ç”Ÿæˆç”¨æˆ·ï¼Œå¤šæ¡ä»¶æŸ¥è¯¢é‚®ä»¶ 

- **ğŸ“ˆ æ•°æ®å¯è§†åŒ–**ï¼šä½¿ç”¨Echartså¯¹ç³»ç»Ÿæ•°æ®è¯¦æƒ…ï¼Œç”¨æˆ·é‚®ä»¶å¢é•¿å¯è§†åŒ–æ˜¾ç¤º

- **ğŸ¨ ä¸ªæ€§åŒ–è®¾ç½®**ï¼šå¯ä»¥è‡ªå®šä¹‰ç½‘ç«™æ ‡é¢˜ï¼Œç™»å½•èƒŒæ™¯ï¼Œé€æ˜åº¦

- **ğŸ¤– äººæœºéªŒè¯**ï¼šé›†æˆTurnstileäººæœºéªŒè¯ï¼Œé˜²æ­¢äººæœºæ‰¹é‡æ³¨å†Œ

- **ğŸ“œ æ›´å¤šåŠŸèƒ½**ï¼šæ­£åœ¨å¼€å‘ä¸­...



## æŠ€æœ¯æ ˆ

- **Serverless**ï¼š[Cloudflare Workers](https://developers.cloudflare.com/workers/)

- **Webæ¡†æ¶**ï¼š[Hono](https://hono.dev/)

- **ORMï¼š**[Drizzle](https://orm.drizzle.team/)

- **å‰ç«¯æ¡†æ¶**ï¼š[Vue3](https://vuejs.org/) 

- **UIæ¡†æ¶**ï¼š[Element Plus](https://element-plus.org/) 

- **é‚®ä»¶æ¨é€ï¼š** [Resend](https://resend.com/)

- **ç¼“å­˜**ï¼š[Cloudflare KV](https://developers.cloudflare.com/kv/)

- **æ•°æ®åº“**ï¼š[Cloudflare D1](https://developers.cloudflare.com/d1/)

- **æ–‡ä»¶å­˜å‚¨**ï¼š[Cloudflare R2](https://developers.cloudflare.com/r2/)

## ä½¿ç”¨æ•™ç¨‹

### ç¯å¢ƒè¦æ±‚

Nodejs v18.20 +

Cloudflare è´¦å· (éœ€è¦ç»‘å®šåŸŸå)


**å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°**
``` shell
git clone https://github.com/eoao/cloud-mail #æ‹‰å–ä»£ç 
cd cloud-mail/mail-worker #è¿›å…¥workerç›®å½•
```

**å®‰è£…ä¾èµ–**
```shell
npm i
```

**é¡¹ç›®é…ç½®**

mail-worker/wrangler.toml

```toml
[[d1_databases]]
binding = "db"			#d1æ•°æ®åº“ç»‘å®šåé»˜è®¤ä¸å¯ä¿®æ”¹
database_name = ""		#d1æ•°æ®åº“åå­—
database_id = ""		#d1æ•°æ®åº“id

[[kv_namespaces]]
binding = "kv"			#kvç»‘å®šåé»˜è®¤ä¸å¯ä¿®æ”¹
id = ""			        #kvæ•°æ®åº“id


[[r2_buckets]]
binding = "r2"                  #r2å¯¹è±¡å­˜å‚¨ç»‘å®šåé»˜è®¤ä¸å¯ä¿®æ”¹
bucket_name = ""	        #r2å¯¹è±¡å­˜å‚¨æ¡¶çš„åå­—
	

[assets]
binding = "assets"		#é™æ€èµ„æºç»‘å®šåé»˜è®¤ä¸å¯ä¿®æ”¹
directory = "./dist"	        #å‰ç«¯vueé¡¹ç›®æ‰“åŒ…çš„é™æ€èµ„æºå­˜æ”¾ä½ç½®,é»˜è®¤dist

[vars]
orm_log = false
domain = []			#é‚®ä»¶åŸŸåå¯ä»¥é…ç½®å¤šä¸ªç¤ºä¾‹: ["example1.com","example2.com"]
admin = ""		        #ç®¡ç†å‘˜çš„é‚®ç®± ç¤ºä¾‹: "admin@example.com"
jwt_secret = ""			#ç™»å½•èº«ä»½ä»¤ç‰Œçš„å¯†é’¥,éšä¾¿å¡«ä¸€ä¸²å­—ç¬¦ä¸²

```



**è¿œç¨‹éƒ¨ç½²**

1. åœ¨ Cloudflare æ§åˆ¶å°åˆ›å»ºKVï¼ŒD1æ•°æ®åº“ï¼ŒR2å¯¹è±¡å­˜å‚¨
2. åœ¨é¡¹ç›®ç›®å½• `mail-worker/wrangler.toml` é…ç½®æ–‡ä»¶ä¸­é…ç½®å¯¹åº”ç¯å¢ƒå˜é‡ï¼Œä»¥åŠåˆ›å»ºçš„æ•°æ®åº“idå’Œåç§°
3. æ‰§è¡Œè¿œç¨‹éƒ¨ç½²å‘½ä»¤

    ```shell
    npm run deploy 
    ```

4. åœ¨Cloudflareâ†’è´¦æˆ·ä¸»é¡µâ†’ä½ çš„åŸŸåâ†’ç”µå­é‚®ä»¶â†’ç”µå­é‚®ä»¶è·¯ç”±â†’è·¯ç”±è§„åˆ™â†’Catch-allåœ°å€ï¼Œç¼–è¾‘å‘é€åˆ°worker

5. æµè§ˆå™¨è¾“å…¥  `https://ä½ çš„é¡¹ç›®åŸŸå/api/init/ä½ çš„jwt_secret`   åˆå§‹åŒ–æˆ–æ›´æ–° d1å’Œkvæ•°æ®åº“

6. éƒ¨ç½²å®Œæˆç™»å½•ç½‘ç«™ï¼Œä½¿ç”¨ç®¡ç†å‘˜è´¦å·å¯ä»¥åœ¨è®¾ç½®é¡µé¢æ·»åŠ é…ç½® R2åŸŸå Turnstileå¯†é’¥ ç­‰


[ğŸ‘‰ ä½¿ç”¨ Github Action éƒ¨ç½²](/doc/github-action.md)

**æœ¬åœ°è¿è¡Œ**

1. æœ¬åœ°è¿è¡Œï¼Œæ•°æ®åº“ï¼Œå¯¹è±¡å­˜å‚¨ä¼šè‡ªåŠ¨å®‰è£…ï¼Œæ— éœ€åˆ›å»ºï¼Œæ•°æ®åº“æ•°æ®ä¿å­˜åœ¨ `mail-worker/.wrangler` æ–‡ä»¶å¤¹

    ```shell
    npm run dev 
    ```
2. æµè§ˆå™¨è¾“å…¥   `http://127.0.0.1:8787/api/init/ä½ çš„jwt_secret`   åˆå§‹åŒ–d1å’Œkvæ•°æ®åº“

3. æœ¬åœ°è¿è¡Œé¡¹ç›®è®¾ç½®é¡µé¢r2åŸŸåå¯è®¾ç½®ä¸º  `http://127.0.0.1:8787/api/file`

**é‚®ä»¶å‘é€**

1. åœ¨ resend å®˜ç½‘æ³¨å†Œåï¼Œç‚¹å‡»å·¦ä¾§ Domains æ·»åŠ å¹¶éªŒè¯ä½ çš„åŸŸåï¼Œç­‰å¾…éªŒè¯å®Œæˆ
2. ç‚¹å‡»å·¦ä¾§ Api Keys åˆ›å»ºç«‹api keyï¼Œ å¤åˆ¶tokenå›åˆ°é¡¹ç›®ç½‘ç«™è®¾ç½®é¡µé¢æ·»åŠ  resend token

3. ç‚¹å‡»å·¦ä¾§ Webhooks æ·»åŠ å›è°ƒåœ°å€  `https://ä½ çš„é¡¹ç›®åŸŸå/api/webhooks` 

   å‹¾é€‰âœ… (email.bounced email.complained email.delivered email.delivery_delayed)

**é¡¹ç›®æ›´æ–°**

æ›´æ–°åéœ€è¦æ‰§è¡Œ `https://ä½ çš„é¡¹ç›®åŸŸå/api/init/ä½ çš„jwt_secret` æ¥åŒæ­¥æ•°æ®åº“ç»“æ„

## ç›®å½•ç»“æ„

```
cloud-mail
â”œâ”€â”€ mail-worker				    # workeråç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src                  
â”‚   â”‚   â”œâ”€â”€ api	 			    # apiæ¥å£å±‚			
â”‚   â”‚   â”œâ”€â”€ const  			    # é¡¹ç›®å¸¸é‡
â”‚   â”‚   â”œâ”€â”€ dao                 # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ email			    # é‚®ä»¶å¤„ç†æ¥æ”¶
â”‚   â”‚   â”œâ”€â”€ entity			    # æ•°æ®åº“å®ä½“
â”‚   â”‚   â”œâ”€â”€ error			    # è‡ªå®šä¹‰å¼‚å¸¸
â”‚   â”‚   â”œâ”€â”€ hono			    # webæ¡†æ¶é…ç½®ã€æ‹¦æˆªå™¨ã€å…¨å±€å¼‚å¸¸ç­‰
â”‚   â”‚   â”œâ”€â”€ i18n			    # è¯­è¨€å›½é™…åŒ–
â”‚   â”‚   â”œâ”€â”€ init			    # æ•°æ®åº“ç¼“å­˜åˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ model			    # å“åº”ä½“æ•°æ®å°è£…
â”‚   â”‚   â”œâ”€â”€ security			# èº«ä»½æƒé™è®¤è¯
â”‚   â”‚   â”œâ”€â”€ service			    # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ template			# æ¶ˆæ¯æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ utils			    # å·¥å…·ç±»
â”‚   â”‚   â””â”€â”€ index.js			# å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ pageckge.json			# é¡¹ç›®ä¾èµ–
â”‚   â””â”€â”€ wrangler.toml			# é¡¹ç›®é…ç½®
â”‚
â”œâ”€â”€ mail-vue				    # vueå‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src
â”‚   â”‚   â”œâ”€â”€ axios 			    # axiosé…ç½®
â”‚   â”‚   â”œâ”€â”€ components			# è‡ªå®šä¹‰ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ echarts			    # echartsç»„ä»¶å¯¼å…¥
â”‚   â”‚   â”œâ”€â”€ i18n			    # è¯­è¨€å›½é™…åŒ–
â”‚   â”‚   â”œâ”€â”€ init			    # å…¥ç«™åˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ layout			    # ä¸»ä½“å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ perm			    # æƒé™è®¤è¯
â”‚   â”‚   â”œâ”€â”€ request			    # apiæ¥å£
â”‚   â”‚   â”œâ”€â”€ router			    # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ store			    # å…¨å±€çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ utils			    # å·¥å…·ç±»
â”‚   â”‚   â”œâ”€â”€ views			    # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ app.vue			    # å…¥å£ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ main.js			    # å…¥å£js
â”‚   â”‚   â””â”€â”€ style.css			# å…¨å±€css
â”‚   â”œâ”€â”€ package.json			# é¡¹ç›®ä¾èµ–
â””â”€â”€ â””â”€â”€ env.release				# é¡¹ç›®é…ç½®
```

## èµåŠ©

<a href="https://doc.skymail.ink/support.html" >
<img width="170px" src="./doc/images/support.png" alt="">
</a>

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT](LICENSE) è®¸å¯è¯	


## äº¤æµ

[Telegram](https://t.me/cloud_mail_tg)



